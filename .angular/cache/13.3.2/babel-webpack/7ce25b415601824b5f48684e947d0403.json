{"ast":null,"code":"import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { isUndefined } from 'lodash';\nimport * as moment from 'moment';\nimport { switchMap } from 'rxjs/operators';\nimport { ResponseCode } from 'src/app/enums/responseCode';\nimport { Constants } from 'src/app/Helper/constants';\nimport { Task } from 'src/app/Models/user';\nimport { UUID } from '../../Helper/constants';\nimport { moveItemInArray } from '@angular/cdk/drag-drop';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/date.service\";\nimport * as i2 from \"src/app/services/user.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/cdk/drag-drop\";\nimport * as i6 from \"../../pipes/moment.pipe\";\n\nfunction OrganaizerComponent_form_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"form\", 11);\n    i0.ɵɵlistener(\"ngSubmit\", function OrganaizerComponent_form_15_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.submit();\n    });\n    i0.ɵɵelementStart(1, \"div\", 12)(2, \"div\", 13);\n    i0.ɵɵelement(3, \"input\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 15)(5, \"button\", 16);\n    i0.ɵɵtext(6, \" \\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.form);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.form.invalid);\n  }\n}\n\nconst _c0 = function (a0, a1) {\n  return {\n    \"btn-outline-danger\": a0,\n    \"btn-success\": a1\n  };\n};\n\nfunction OrganaizerComponent_div_16_div_2_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function OrganaizerComponent_div_16_div_2_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const task_r7 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return ctx_r10.isAdmin ? ctx_r10.remove(task_r7.id) : ctx_r10.success(task_r7.id);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(2, _c0, ctx_r8.isAdmin, !ctx_r8.isAdmin));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r8.isAdmin ? \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\" : \"\\u0412\\u044B\\u043F\\u043E\\u043B\\u043D\\u0435\\u043D\\u043E\", \" \");\n  }\n}\n\nfunction OrganaizerComponent_div_16_div_2_a_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 24);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 25);\n    i0.ɵɵelement(2, \"path\", 26)(3, \"path\", 27);\n    i0.ɵɵelementEnd()();\n  }\n}\n\nconst _c1 = function (a0, a1) {\n  return {\n    \"text-decoration-line-through list-group-item-success\": a0,\n    \"list-group-item-primary\": a1\n  };\n};\n\nfunction OrganaizerComponent_div_16_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, OrganaizerComponent_div_16_div_2_button_2_Template, 2, 5, \"button\", 21);\n    i0.ɵɵtemplate(3, OrganaizerComponent_div_16_div_2_a_3_Template, 4, 0, \"a\", 22);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(4, _c1, task_r7.completed, !task_r7.completed));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", task_r7.title, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !task_r7.completed);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", task_r7.completed);\n  }\n}\n\nconst _c2 = function (a0) {\n  return {\n    \"cursor: move\": a0\n  };\n};\n\nfunction OrganaizerComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"div\", 18);\n    i0.ɵɵlistener(\"cdkDropListDropped\", function OrganaizerComponent_div_16_Template_div_cdkDropListDropped_1_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.drop($event);\n    });\n    i0.ɵɵtemplate(2, OrganaizerComponent_div_16_div_2_Template, 4, 7, \"div\", 19);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(2, _c2, ctx_r1.isAdmin));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.tasks);\n  }\n}\n\nfunction OrganaizerComponent_ng_template_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28)(1, \"p\", 29);\n    i0.ɵɵtext(2, \"\\u0437\\u0430\\u0434\\u0430\\u0447 \\u043D\\u0435\\u0442\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nexport let OrganaizerComponent = /*#__PURE__*/(() => {\n  class OrganaizerComponent {\n    constructor(dateService, userService) {\n      this.dateService = dateService;\n      this.userService = userService;\n      this.tasks = [];\n      this.movies = ['Episode I - The Phantom Menace', 'Episode II - Attack of the Clones', 'Episode III - Revenge of the Sith', 'Episode IV - A New Hope', 'Episode V - The Empire Strikes Back', 'Episode VI - Return of the Jedi', 'Episode VII - The Force Awakens', 'Episode VIII - The Last Jedi', 'Episode IX – The Rise of Skywalker'];\n    }\n\n    drop(event) {\n      moveItemInArray(this.tasks, event.previousIndex, event.currentIndex);\n    }\n\n    get user() {\n      return JSON.parse(localStorage.getItem(Constants.USER_KEY));\n    }\n\n    get isAdmin() {\n      return this.user.roles.indexOf('Admin') > -1;\n    }\n\n    ngOnInit() {\n      this.form = new FormGroup({\n        title: new FormControl('', Validators.required)\n      });\n    }\n\n    ngOnChanges() {\n      if (!isUndefined(this.selectedUserId)) {\n        this.dateService.date.pipe(switchMap(date => {\n          return this.userService.getTasks(date.format('DD.MM.YYYY'), this.selectedUserId);\n        })).subscribe(tasks => {\n          this.tasks = tasks;\n        });\n        this.getDayQuantitiesNow();\n        this.form = new FormGroup({\n          title: new FormControl('', Validators.required)\n        });\n      }\n    }\n\n    nowDate() {\n      this.dateService.date.next(moment());\n      this.getDayQuantitiesNow();\n    }\n\n    submit() {\n      const date = this.dateService.date.value.format('DD.MM.YYYY');\n      const newTask = new Task();\n      newTask.title = this.form.value.title;\n      newTask.id = UUID();\n      newTask.completed = false;\n      this.userService.create(newTask, date, this.selectedUserId).subscribe(res => {\n        if (res) {\n          this.form.reset();\n          newTask.date = this.dateService.date.value.format('YYYY-MM-DDT00:00:00');\n          this.tasks.push(newTask);\n          const dayQuantities = this.dateService.dayQuantities.value;\n          dayQuantities.push(newTask);\n          this.dateService.dayQuantities.next(dayQuantities);\n        }\n      });\n    }\n\n    remove(id) {\n      this.userService.removeTasks(id).subscribe(res => {\n        if (res.responseCode = ResponseCode.OK) {\n          this.tasks = this.tasks.filter(task => task.id !== id);\n          const dayQuantities = this.dateService.dayQuantities.value.filter(quantity => quantity.id !== id);\n          this.dateService.dayQuantities.next(dayQuantities);\n        }\n      });\n    }\n\n    success(id) {\n      this.userService.successTasks(id).subscribe(res => {\n        if (res.responseCode = ResponseCode.OK) {\n          this.tasks.find(task => task.id === id).completed = true; // const dayQuantities = this.dateService.dayQuantities.value.filter(\n          //   (quantity) => quantity.id !== id\n          // );\n          // this.dateService.dayQuantities.next(dayQuantities);\n        }\n      });\n    }\n\n    getDayQuantitiesNow() {\n      this.userService.getTaskMonth(this.dateService.date.value.format('DD.MM.YYYY'), this.selectedUserId).subscribe(dayQuantities => {\n        this.dayQuantities = dayQuantities;\n        this.dateService.dayQuantities.next(dayQuantities);\n      });\n    }\n\n  }\n\n  OrganaizerComponent.ɵfac = function OrganaizerComponent_Factory(t) {\n    return new (t || OrganaizerComponent)(i0.ɵɵdirectiveInject(i1.DateService), i0.ɵɵdirectiveInject(i2.UserService));\n  };\n\n  OrganaizerComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: OrganaizerComponent,\n    selectors: [[\"app-organaizer\"]],\n    inputs: {\n      selectedUserId: \"selectedUserId\"\n    },\n    features: [i0.ɵɵNgOnChangesFeature],\n    decls: 19,\n    vars: 9,\n    consts: [[1, \"mb-3\", \"ml3\", \"mt-3\"], [1, \"d-flex\", \"justify-content-center\", \"mb-2\"], [\"data-bs-toggle\", \"tooltip\", \"title\", \"\\u0441\\u0435\\u0433\\u043E\\u0434\\u043D\\u044F\", 1, \"btn\", \"btn-link\", \"btn_\", 3, \"click\"], [\"width\", \"1em\", \"height\", \"1em\", \"viewBox\", \"0 0 16 16\", \"fill\", \"currentColor\", \"xmlns\", \"http://www.w3.org/2000/svg\", 1, \"bi\", \"bi-calendar4-event\"], [\"fill-rule\", \"evenodd\", \"d\", \"M14 2H2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1zM2 1a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H2z\"], [\"fill-rule\", \"evenodd\", \"d\", \"M14 2H2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1zM2 1a2 2 0 0 0-2 2v2h16V3a2 2 0 0 0-2-2H2z\"], [\"fill-rule\", \"evenodd\", \"d\", \"M3.5 0a.5.5 0 0 1 .5.5V1a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5zm9 0a.5.5 0 0 1 .5.5V1a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 .5-.5z\"], [\"width\", \"2\", \"height\", \"2\", \"x\", \"11\", \"y\", \"7\", \"rx\", \".5\"], [3, \"formGroup\", \"ngSubmit\", 4, \"ngIf\"], [\"class\", \"list-group mt-3\", 4, \"ngIf\", \"ngIfElse\"], [\"noTasks\", \"\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"row\", \"justify-content-start\"], [1, \"col-11\"], [\"type\", \"text\", \"formControlName\", \"title\", 1, \"form-control\"], [1, \"col-1\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"btn-block\", \"float-end\", 3, \"disabled\"], [1, \"list-group\", \"mt-3\"], [\"cdkDropList\", \"\", 1, \"list-group\", \"w-100\", 2, \"cursor\", \"move\", 3, \"ngStyle\", \"cdkDropListDropped\"], [\"class\", \"list-group-item d-flex justify-content-between align-items-center mt-1\", \"cdkDrag\", \"\", 3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [\"cdkDrag\", \"\", 1, \"list-group-item\", \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mt-1\", 3, \"ngClass\"], [\"type\", \"submit\", \"class\", \"btn btn-outline-danger\", 3, \"ngClass\", \"click\", 4, \"ngIf\"], [\"data-bs-toggle\", \"tooltip\", \"title\", \"\\u0437\\u0430\\u0434\\u0430\\u0447\\u0430 \\u0435\\u0449\\u0451 \\u043D\\u0435 \\u043F\\u0440\\u043E\\u0432\\u0435\\u0440\\u0435\\u043D\\u0430\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-outline-danger\", 3, \"ngClass\", \"click\"], [\"data-bs-toggle\", \"tooltip\", \"title\", \"\\u0437\\u0430\\u0434\\u0430\\u0447\\u0430 \\u0435\\u0449\\u0451 \\u043D\\u0435 \\u043F\\u0440\\u043E\\u0432\\u0435\\u0440\\u0435\\u043D\\u0430\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"width\", \"16\", \"height\", \"16\", \"fill\", \"currentColor\", \"viewBox\", \"0 0 16 16\", 1, \"bi\", \"bi-clock\"], [\"d\", \"M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z\"], [\"d\", \"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z\"], [1, \"d-flex\", \"justify-content-center\", \"p-2\", \"bd-highlight\"], [1, \"\"]],\n    template: function OrganaizerComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0)(1, \"header\", 1)(2, \"div\")(3, \"span\")(4, \"button\", 2);\n        i0.ɵɵlistener(\"click\", function OrganaizerComponent_Template_button_click_4_listener() {\n          return ctx.nowDate();\n        });\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(5, \"svg\", 3);\n        i0.ɵɵelement(6, \"path\", 4)(7, \"path\", 5)(8, \"path\", 6)(9, \"rect\", 7);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtext(10, \" \\u0441\\u043F\\u0438\\u0441\\u043E\\u043A \\u0437\\u0430\\u0434\\u0430\\u0447: \");\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(11, \"strong\");\n        i0.ɵɵtext(12);\n        i0.ɵɵpipe(13, \"moment\");\n        i0.ɵɵpipe(14, \"async\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵtemplate(15, OrganaizerComponent_form_15_Template, 7, 2, \"form\", 8);\n        i0.ɵɵtemplate(16, OrganaizerComponent_div_16_Template, 3, 4, \"div\", 9);\n        i0.ɵɵtemplate(17, OrganaizerComponent_ng_template_17_Template, 3, 0, \"ng-template\", null, 10, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        const _r2 = i0.ɵɵreference(18);\n\n        i0.ɵɵadvance(12);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(13, 4, i0.ɵɵpipeBind1(14, 7, ctx.dateService.date), \" Do MMMM YYYY\"), \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.isAdmin);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.tasks.length)(\"ngIfElse\", _r2);\n      }\n    },\n    directives: [i3.NgIf, i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.DefaultValueAccessor, i4.NgControlStatus, i4.FormControlName, i5.CdkDropList, i3.NgStyle, i3.NgForOf, i5.CdkDrag, i3.NgClass],\n    pipes: [i6.MomentPipe, i3.AsyncPipe],\n    styles: [\".btn_[_ngcontent-%COMP%]{line-height:.5!important}.example-list[_ngcontent-%COMP%]{width:500px;max-width:100%;border:solid 1px #ccc;min-height:60px;display:block;background:white;border-radius:4px;overflow:hidden}.example-box[_ngcontent-%COMP%]{padding:20px 10px;border-bottom:solid 1px #ccc;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;cursor:move;background:white;font-size:14px}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .example-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}\"]\n  });\n  return OrganaizerComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}